{"version":3,"sources":["../src/heatmap.js"],"names":["heatmap","data","num_of_slices","elem","svg_id","elem_size","date_domain","bin_domain","frq_domain","all_buckets","number_of_legend","my_log","x","Math","log","my_exp","exp","legend_color","margin","top","right","bottom","left","width","height","xStep_ms","ceil","max","min","yStep","vertical_domain_length","rect_size","Date","getTime","svg","d3","select","attr","append","x_scale","time","scale","range","domain","y_scale","linear","z_scale","tooltip_div","style","selectAll","enter","d","date","bin","value","on","transition","html","event","pageX","pageY","xAxisFunc","axis","orient","xAxis","call","text","yAxisFunc","tickFormat","t","yAxis","legend","ticks","reverse","i","String","floor"],"mappings":"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","file":"heatmap.js","sourcesContent":["import './bower_components/d3/d3.js';\n\n\nexport default function heatmap(data, num_of_slices, elem, svg_id, elem_size, date_domain, bin_domain, frq_domain, all_buckets, number_of_legend) {\n\n    function my_log(x) {\n        return Math.log(x);\n    }\n\n    function my_exp(x) {\n        return Math.exp(x);\n    }\n\n    var legend_color = \"red\";\n\n    var margin = {top: 20, right: 90, bottom: 50, left: 90};\n    var width = elem_size.width - margin.left - margin.right;\n    var height = elem_size.height - margin.top - margin.bottom;\n\n    var xStep_ms = Math.ceil((date_domain.max - date_domain.min)/num_of_slices);\n    var yStep = 1;\n\n    var vertical_domain_length = bin_domain.max-bin_domain.min;\n    var rect_size = Math.min(width/num_of_slices, height/vertical_domain_length);\n\n    // Extend the x- to fit the last bucket\n    date_domain.max = new Date(date_domain.max.getTime() + xStep_ms);\n\n    width = rect_size*num_of_slices;\n    height = rect_size*vertical_domain_length;\n\n    var svg = d3.select(\"svg#\"+svg_id).attr('width', width + margin.left + margin.right).attr('height', height + margin.top + margin.bottom)\n                .append(\"g\").attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\"); //Move the origin of drawing\n\n\n\n    // In getting log we added 1 to each frequency so we never encounter Log(0) situation\n    var x_scale = d3.time.scale().range([0, width]).domain([date_domain.min, date_domain.max]);\n    var y_scale = d3.scale.linear().range([height, 0]).domain([bin_domain.min, bin_domain.max]);\n    var z_scale = d3.scale.linear().range(['white', 'darkred']).domain([my_log(frq_domain.min+1), my_log(frq_domain.max+1)]);\n\n\n    // Define the div for the tooltip\n    var tooltip_div = d3.select(\"body\").append(\"div\")\n        .attr(\"class\", \"tooltip\")\n        .style(\"background-color\", \"black\")\n        .style(\"opacity\", 0);\n\n    // Draw heat map tiles\n    // x and y indicates upper left of the rect, hence the \"+ yStep\" in 'y' is needed to prevent first row from going out of the div.\n    svg.selectAll(\".tile\")\n        .data(data)\n        .enter()\n        .append(\"rect\")\n        .attr('x', d => x_scale(d.date))\n        .attr('y', d => y_scale(d.bin + yStep))\n        .attr(\"height\", rect_size)\n        .attr(\"width\", rect_size)\n        .style(\"fill\", d => z_scale(my_log(d.value+1)))\n        .on(\"mouseover\", function(d) {\t\t\n            tooltip_div.transition()\n                .style(\"opacity\", 1);\n            tooltip_div\t.html(\"</span> date: \" + d.date + \"<br/> bin: \" + all_buckets[d.bin] + \"<br/> value: \" + d.value + \"</span>\")\t\n                .style(\"left\", (d3.event.pageX) + \"px\")\n                .style(\"top\", (d3.event.pageY - 75) + \"px\");\n            });\n\n    // Add a call back function to hide tooltip_div when mouse goes out of our svg.\n    svg.on(\"mouseout\", () => tooltip_div.style(\"opacity\", 0));\n\n    // Add X Axis\n    var xAxisFunc = d3.svg.axis().scale(x_scale).orient(\"bottom\");\n    var xAxis = svg.append(\"g\").attr(\"transform\", \"translate(0,\" + height + \")\").call(xAxisFunc).attr(\"fill\", legend_color);\n    xAxis.append(\"text\")\n         .attr(\"x\", width/2)\n         .attr(\"y\", 40)\n         .attr(\"text-anchor\", \"end\")\n         .text(\"Date\");\n\n    // Add Y Axis\n    var yAxisFunc = d3.svg.axis().scale(y_scale).orient(\"left\").tickFormat(t => all_buckets[t]);\n    var yAxis = svg.append(\"g\").call(yAxisFunc).attr(\"fill\", legend_color);\n    yAxis.append(\"text\")\n         .attr(\"x\", -height/2)\n         .attr(\"y\", -60)\n         .attr(\"dy\", \".71em\")\n         .attr(\"transform\", \"rotate(-90)\")\n         .text(\"Duration\");\n\n    // Add a legend for the color values.\n    var legend = svg.selectAll(\".legend\")\n                    .data(z_scale.ticks(number_of_legend).reverse())\n                    .enter().append(\"g\")\n                    .attr(\"class\", \"legend\")\n                    .attr(\"transform\", function(d, i) { return \"translate(\" + (width + rect_size) + \",\" + (rect_size + i * rect_size) + \")\"; });\n\n    legend.append(\"rect\")\n          .attr(\"width\", rect_size)\n          .attr(\"height\", rect_size)\n          .style(\"fill\", z_scale);\n\n    legend.append(\"text\")\n          .attr(\"x\", rect_size + 6)\n          .attr(\"y\", 10)\n          .attr(\"dy\", \".35em\")\n          .attr(\"fill\", legend_color)\n          .text(d => String(Math.floor(my_exp(d)-1)));\n\n    svg.append(\"text\")\n       .attr(\"class\", \"label\")\n       .attr(\"x\", width + rect_size)\n       .attr(\"y\", 5)\n       .attr(\"dy\", \".35em\")\n       .attr(\"fill\", legend_color)\n       .text(\"Count\");\n}\n"]}