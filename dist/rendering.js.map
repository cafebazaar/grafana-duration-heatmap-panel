{"version":3,"sources":["../src/rendering.js"],"names":["makeid","prefix","text","possible","i","charAt","Math","floor","random","length","link","scope","elem","attrs","ctrl","data","panel","find","events","on","render","renderingCompleted","setElementHeight","height","row","_","isString","parseInt","replace","title","css","e","addHeatMap","svg_id","plotCanvas","$","html","elem_size","width","date_domain","min","min_date","max","max_date","bin_domain","all_buckets","frq_domain","min_frq","max_frq","heatmap","series_array","num_of_slices","number_of_legend"],"mappings":";;;;;;;;AAEA,WAASA,MAAT,CAAgBC,MAAhB,EACA;AACI,QAAIC,OAAOD,MAAX;AACA,QAAME,WAAW,gEAAjB;;AAEA,SAAK,IAAIC,IAAE,CAAX,EAAcA,IAAI,EAAlB,EAAsBA,GAAtB;AACIF,cAAQC,SAASE,MAAT,CAAgBC,KAAKC,KAAL,CAAWD,KAAKE,MAAL,KAAgBL,SAASM,MAApC,CAAhB,CAAR;AADJ,KAGA,OAAOP,IAAP;AACH;;AAEc,WAASQ,IAAT,CAAcC,KAAd,EAAqBC,IAArB,EAA2BC,KAA3B,EAAkCC,IAAlC,EAAwC;AACrD,QAAIC,IAAJ,EAAUC,KAAV;AACAJ,WAAOA,KAAKK,IAAL,CAAU,gBAAV,CAAP;;AAEAH,SAAKI,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,YAAW;AAClCC;AACAN,WAAKO,kBAAL;AACD,KAHD;;AAKA,aAASC,gBAAT,GAA4B;AAC1B,UAAI;AACF,YAAIC,SAAST,KAAKS,MAAL,IAAeP,MAAMO,MAArB,IAA+BT,KAAKU,GAAL,CAASD,MAArD;AACA,YAAIE,EAAEC,QAAF,CAAWH,MAAX,CAAJ,EAAwB;AACtBA,mBAASI,SAASJ,OAAOK,OAAP,CAAe,IAAf,EAAqB,EAArB,CAAT,EAAmC,EAAnC,CAAT;AACD;;AAEDL,kBAAU,CAAV,CANE,CAMW;AACbA,kBAAUP,MAAMa,KAAN,GAAc,EAAd,GAAmB,CAA7B,CAPE,CAO8B;;AAEhCjB,aAAKkB,GAAL,CAAS,QAAT,EAAmBP,SAAS,IAA5B;;AAEA,eAAO,IAAP;AACD,OAZD,CAYE,OAAMQ,CAAN,EAAS;AAAE;AACX,eAAO,KAAP;AACD;AACF;;AAED,aAASC,UAAT,GAAsB;;AAEpB;AACA,UAAIC,SAASjC,OAAO,cAAP,CAAb;AACA,UAAIkC,aAAaC,EAAE,cAAcF,MAAd,GAAuB,UAAzB,CAAjB;AACArB,WAAKwB,IAAL,CAAUF,UAAV;;AAEA,UAAIG,YAAY,EAACC,OAAO1B,KAAK0B,KAAL,EAAR,EAAsBf,QAAQX,KAAKW,MAAL,EAA9B,EAAhB;AACA,UAAIgB,cAAc,EAACC,KAAKzB,KAAK0B,QAAX,EAAqBC,KAAK3B,KAAK4B,QAA/B,EAAlB;AACA,UAAIC,aAAa,EAACJ,KAAK,CAAN,EAASE,KAAK3B,KAAK8B,WAAL,CAAiBpC,MAA/B,EAAjB;AACA,UAAIqC,aAAa,EAACN,KAAI1B,KAAKE,KAAL,CAAW+B,OAAhB,EAAyBL,KAAK5B,KAAKE,KAAL,CAAWgC,OAAzC,EAAjB;;AAEAC,cAAQlC,KAAKmC,YAAb,EAA2BpC,KAAKE,KAAL,CAAWmC,aAAtC,EAAqDvC,IAArD,EAA2DqB,MAA3D,EAAmEI,SAAnE,EAA8EE,WAA9E,EAA2FK,UAA3F,EAAuGE,UAAvG,EAAmH/B,KAAK8B,WAAxH,EAAqI/B,KAAKE,KAAL,CAAWoC,gBAAhJ;AACD;;AAED,aAAShC,MAAT,GAAkB;AAChB,UAAIN,KAAKC,IAAL,CAAUmC,YAAV,CAAuBzC,MAAvB,IAAiC,CAArC,EAAwC;AACtC;AACA,YAAIyB,aAAaC,EAAE,aAAF,CAAjB;AACAvB,aAAKwB,IAAL,CAAUF,UAAV;AACA;AACD;;AAEDnB,aAAOD,KAAKC,IAAZ;AACAC,cAAQF,KAAKE,KAAb;;AAEA,UAAIM,kBAAJ,EAAwB;AACtBU;AACD;AACF;AACF;;qBAzDuBtB,I;;;;AAbjBuC,a","file":"rendering.js","sourcesContent":["import heatmap from './heatmap';\n\nfunction makeid(prefix)\n{\n    var text = prefix;\n    const possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\n    for( var i=0; i < 10; i++ )\n        text += possible.charAt(Math.floor(Math.random() * possible.length));\n\n    return text;\n}\n\nexport default function link(scope, elem, attrs, ctrl) {\n  var data, panel;\n  elem = elem.find('.heatmap-panel');\n\n  ctrl.events.on('render', function() {\n    render();\n    ctrl.renderingCompleted();\n  });\n\n  function setElementHeight() {\n    try {\n      var height = ctrl.height || panel.height || ctrl.row.height;\n      if (_.isString(height)) {\n        height = parseInt(height.replace('px', ''), 10);\n      }\n\n      height -= 5; // padding\n      height -= panel.title ? 24 : 9; // subtract panel title bar\n\n      elem.css('height', height + 'px');\n\n      return true;\n    } catch(e) { // IE throws errors sometimes\n      return false;\n    }\n  }\n\n  function addHeatMap() {\n\n    // clear old data\n    var svg_id = makeid(\"heatmap_svg_\")\n    var plotCanvas = $(\"<svg id='\" + svg_id + \"'></svg>\");\n    elem.html(plotCanvas);\n\n    var elem_size = {width: elem.width(), height: elem.height()};\n    var date_domain = {min: data.min_date, max: data.max_date};\n    var bin_domain = {min: 0, max: data.all_buckets.length};\n    var frq_domain = {min:ctrl.panel.min_frq, max: ctrl.panel.max_frq};\n\n    heatmap(data.series_array, ctrl.panel.num_of_slices, elem, svg_id, elem_size, date_domain, bin_domain, frq_domain, data.all_buckets, ctrl.panel.number_of_legend);\n  }\n\n  function render() {\n    if (ctrl.data.series_array.length == 0) {\n      //clear the svg in case of empty array\n      var plotCanvas = $(\"<svg></svg>\");\n      elem.html(plotCanvas);\n      return;\n    }\n\n    data = ctrl.data;\n    panel = ctrl.panel;\n\n    if (setElementHeight()) {\n      addHeatMap();\n    }\n  }\n}\n"]}